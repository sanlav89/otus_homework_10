# Задание 10
## Асинхронный сервер, выполняющий операции пересечения и симметрической разницы над множествами  
### Требования  
1) Соответствие протоколу.  
2) Будет отмечена оценка сложности добавления новых записей в таблицы, очистки и операций над множествами.   
3) Отсутствие блокировки при длительной отправке результирующего блока клиенту.  
4) Отсутствие блокировки при длительном выполнении операций над множествами.  
5) Устойчивость к выполнению операций INSERT во время работы операций INTERSECTION и SYMMETRIC_DIFFERENCE или отправки результата этих операций.  

### Реализация  
  
Класс **Table** - одна таблица из базы данных. Для простоты предположил, что для хранения БД есть некий ограниченный объем памяти, 
поэтому воспользовался std::array для моделирования этой памяти. Не стал заморачиваться с хранением на жестком диске и т.п. 
Выбор такой структуры данных обусловлен тем, что будут минимизированы блокировки: блокируется только конкретная строка из таблицы (не вся таблица). 
Для более быстрого доступа к элементам  array организована вспомогательная структура данных на std::map, которая хранит соответсвие {id, индекс}. 
  
Класс **DataBase** - база данных, реализующая интерфейс запросов операций над множествами. 
В **DataBase** хранится 2 экземпляра **Table**: таблица "A" и таблица "B".  
  
Классы **Session**, **Server** - взяты из шаблона asio_server_async из урока по асинхронному вводу/выводу средствами boost::asio.  
В **Server** хранится экземпляр **DataBase**. В **Session** передается ссылка на этот экземпляр **DataBase**.  

### Соответствие требованиям  

1) Соответствие протоколу проверено при помощи утилиты join_server, а также при помощи unit-тестов (gtest_database.cpp)  
  
2) Оценка сложности операций:  
|Операция|Сложность|Комментарий|
|--------|---------|-----------|
|INSERT|O(log(N))||
|TRUNCATE|O(N)|N - размер таблицы|
|INTERSECTION|O(min{N1, N2})|N1, N2 - размеры таблиц|
|SYMMETRIC_DIFFERENCE|O(max{N1, N2})|N1, N2 - размеры таблиц|  
  
3) Отсутствие блокировки при длительной отправке результата достигается асинхронной работой сервера.  

4) Отсутствие блокировки при длительном выполнении операций над множествами: в текущей реализации при чтении данных нет блокировок. 
А операции над множествами основаны на чтении данных и выдачи результата в определенном протоколом виде.  
  
5) Устойчивость к выполнению операций INSERT: данная операция сопровождается блокировкой одной строки таблицы.  
